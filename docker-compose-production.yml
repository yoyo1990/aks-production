# ðŸš€ ×ž×¢×¨×›×ª Bitcoin ×ž×¢×•×“×›× ×ª ×¢× Authentication
version: '3.8'

services:
  # ðŸª™ Bitcoin Service A
  service-a:
    image: bitcoin-app-a:v2.0
    container_name: bitcoin-service-a
    ports:
      - "8080:8080"
    environment:
      - FLASK_ENV=production
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8080/healthz"]
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped
    networks:
      - bitcoin-network

  # ðŸŽ¯ Service B (×–×”×” ×œA ××‘×œ ×œ×œ× ×—×©×™×¤×” ×—×™×¦×•× ×™×ª)
  service-b:
    image: bitcoin-app-b:v2.0
    container_name: bitcoin-service-b
    environment:
      - FLASK_ENV=production
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8080/healthz"]
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped
    networks:
      - bitcoin-network

  # ðŸŒ Nginx Proxy ×¢× Authentication ×ž×•×‘× ×”
  nginx-proxy:
    image: nginx:alpine
    container_name: bitcoin-proxy
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./production-nginx.conf:/etc/nginx/nginx.conf:ro
    depends_on:
      - service-a
      - service-b
    command: >
      sh -c "
      apk add --no-cache apache2-utils &&
      htpasswd -cb /tmp/auth.htpasswd arad arad1980 &&
      nginx -g 'daemon off;'
      "
    restart: unless-stopped
    networks:
      - bitcoin-network

networks:
  bitcoin-network:
    driver: bridge